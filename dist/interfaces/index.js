"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(a,u){try{var o=t[a](u),i=o.value}catch(e){return void r(e)}if(!o.done)return Promise.resolve(i).then(function(e){n("next",e)},function(e){n("throw",e)});e(i)}return n("next")})}}Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_config=require("./../config.js"),_config2=_interopRequireDefault(_config),_request=require("./../utils/request.js"),_request2=_interopRequireDefault(_request),interfaces={getUserInfo:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_wepy2.default.getUserInfo();case 2:return t=e.sent,r=t.userInfo,e.next=6,_wepy2.default.login();case 6:return n=e.sent,a=n.code,e.next=10,_wepy2.default.setStorage({key:"userInfo",data:r});case 10:return e.abrupt("return",{userInfo:JSON.stringify(r),code:a});case 11:case"end":return e.stop()}},e,this)}));return e}(),login:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={},r={},e.prev=2,e.next=5,interfaces.getUserInfo();case 5:return t=e.sent,e.next=8,_wepy2.default.request({url:_config2.default.users.login.url,data:t,method:_config2.default.users.login.method,header:{"content-type":"application/x-www-form-urlencoded"}});case 8:return r=e.sent,e.next=11,_wepy2.default.setStorage({key:"_token",data:r.data.info._token});case 11:console.log(r),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),_wepy2.default.showModal({title:"提示",content:"获取用户信息失败，请关闭重新进入。"+e.t0.message});case 17:case"end":return e.stop()}},e,this,[[2,14]])}));return e}(),uploadImg:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_wepy2.default.chooseImage();case 2:return t=e.sent,e.next=5,_wepy2.default.uploadFile({url:"https://www.2p98.cn/api/public/uploadImg",filePath:t.tempFilePaths[0],name:"filename"});case 5:return r=e.sent,n=r.data,console.log(n),e.abrupt("return",n);case 9:case"end":return e.stop()}},e,this)}));return e}(),getPayinfo:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_wepy2.default.requestPayment({timeStamp:t.timeStamp,nonceStr:t.nonceStr,package:t.package,signType:"MD5",paySign:t.paySign});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}},e,this)}));return e}(),copyText:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_wepy2.default.setClipboardData({data:t});case 2:return e.next=4,_wepy2.default.getClipboardData();case 4:return r=e.sent,r.data&&_wepy2.default.showToast({title:"复制成功"}),e.abrupt("return",r);case 7:case"end":return e.stop()}},e,this)}));return e}(),globalConfig:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_request2.default)({url:_config2.default.public.global.url,method:_config2.default.public.global.method});case 2:return t=e.sent,r=t.data,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return e}(),getMyinfo:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_request2.default)({url:_config2.default.users.get.url,method:_config2.default.users.get.method,data:{}},!0);case 2:return t=e.sent,r=t.data,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return e}(),getActivityInfo:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_request2.default)({url:_config2.default.activity.info.url,method:_config2.default.activity.info.method,data:{aid:t}},!0);case 2:return r=e.sent,n=r.data,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return e}(),previewImg:function(e,t){_wepy2.default.previewImage({current:e,urls:t})},getProgress:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_request2.default)({url:_config2.default.activity.myprogress.url,method:_config2.default.activity.myprogress.method,data:{aid:t}},!0);case 2:return r=e.sent,n=r.data,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return e}(),downFile:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_wepy2.default.downloadFile({url:t});case 2:return r=e.sent,e.abrupt("return",r.tempFilePath);case 4:case"end":return e.stop()}},e,this)}));return e}(),wxPay:function(e){return new Promise(function(t,r){wx.requestPayment(_extends({},e,{complete:function(e){"requestPayment:ok"===e.errMsg?t(e):r(e)}}))})},activityShare:function(e,t,r){return{title:e,path:"/pages/index/pk?id="+t,imageUrl:r,success:function(e){_wepy2.default.showToast({title:"分享成功"})}}}};exports.default=interfaces;