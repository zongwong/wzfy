<style lang="scss">
.recommend{
  .ceils_wrap{
    padding: 18rpx 36rpx;
    margin-top: 18rpx;
    .list_item{
      border-radius: 8rpx;
      border: 2rpx solid #e9e9e9;
      margin-bottom: 20rpx;
      padding: 15px;
      overflow: hidden;
      .status{
        position: absolute;
        top: 0;
        left: 0;
        width: 57rpx;
        height: 58rpx;
        background-position: center;
        background-repeat: no-repeat;
        background-size: 100%;
        &.yescj{
          background-image: url(data:image/png;base64,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);
        }
        &.nocj{
          background-image: url(data:image/png;base64,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);
        }
      }
    }
  }
}
</style>
<template>
  <view class="container recommend">
    <tab :navs="navs"></tab>
    <!-- <view style="height:600px"></view> -->
    <view class="ceils_wrap">
      <navigator class="ceil_item ceil_item_access list_item" wx:for="{{list}}" wx:key="re_{{index}}" url="/pages/user/redetail?id={{item.id}}">
        <view class="ceil_bd">{{item.name}}</view>
        <view class="ceil_ft">{{item.created_at}}</view>
        <view wx:if="{{tabIndex==1}}" class="status yescj"></view>
        <view wx:if="{{tabIndex==2}}" class="status nocj"></view>
      </navigator>
    </view>
  </view>
</template>

<script>
  import wepy from 'wepy'
  import tab from '../../components/tab'
  import api from '../../interfaces/api'
  export default class Recommend extends wepy.page {
    config = {
      navigationBarTitleText: '我的推荐'
    }

    data = {
        navs:[{
            text:'未完成',
            selected:true,
        },{
            text:'已成交',
            selected:false,
        },{
            text:'未成交',
            selected:false,
        }],
        list:[],
        type:['new-house','hand-house','finance','decorate'],
        status:['pending','processing','succeed','failed'],
        tabIndex:0,
        page:1,
        isEnd:false
    }
    components = {
      tab:tab
    }

    methods = {
     
    }

    events = {
      async navTapEvent(index) {
        this.isEnd = false
        this.page = 1
        this.list = []
        this.$apply()
        if(index==0){
          await this.getisIng()
        }else if(index==1){
          await this.getSuccessed()
        }else{
          await this.getFail()
        }
        this.tabIndex = index
        this.$apply()
      }
    }

    async onLoad() {
      await this.getisIng()
    }

    async getisIng() {
      let that = this
      return await Promise.all(
        this.type.map(async function(val) {
          console.log('xx return:'+val)
          let arr = []
          // const pending = await api.getReports({
          //   type:val,
          //   status:'pending',
          //   page:that.page
          // })
          const processing = await api.getReports({
            type:val,
            status:'processing',
            page:that.page,
          })
          return arr.concat(processing.data)

        })
      ).then((res)=>{
        let arr = []
        res.forEach(item => {
          arr = arr.concat(item)
        })
        if(!arr.length){
          this.isEnd = true
        }else{
          this.list = this.timeSort(this.list.concat(arr))
        }
        // return arr
        // this.list = this.timeSort(this.list.concat(arr))
        this.$apply()
      })

    }
    async getFail() {
      let that = this
      return await Promise.all(
        this.type.map(async function(val) {
          const failed = await api.getReports({
            type:val,
            status:'failed',
            page:that.page
          })
          return failed.data

        })
      ).then((res)=>{
        let arr = []
        res.forEach(item => {
          arr = arr.concat(item)
        })
        if(!arr.length){
          this.isEnd = true
        }else{
          this.list = this.timeSort(this.list.concat(arr))
        }
        this.$apply()
      })
    }
    async getSuccessed() {
      let that = this
      return await Promise.all(
        this.type.map(async function(val) {
          const succeed = await api.getReports({
            type:val,
            status:'succeed',
            page:that.page
          })
          return succeed.data

        })
      ).then((res)=>{
        let arr = []
        res.forEach(item => {
          arr = arr.concat(item)
        })
        if(!arr.length){
          this.isEnd = true
        }else{
          this.list = this.timeSort(this.list.concat(arr))
        }
        this.$apply()
      })
    }
    onReachBottom() {
      if(this.isEnd){
        return false
      }
      this.page += 1
      if(this.tabIndex==0){
        this.getisIng()
      }else if(this.tabIndex==1){
        this.getSuccessed()
      }else{
        this.getFail()
      }
    }
    timeSort(arr) {
      return arr.sort((a, b) => new Date(b.updated_at.replace(/-/g, '/')).getTime() - new Date(a.updated_at.replace(/-/g, '/')).getTime())
    }
  }
</script>
